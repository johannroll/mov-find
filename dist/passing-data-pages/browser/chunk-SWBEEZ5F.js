import{a as j,j as g,k as T}from"./chunk-Y45GAI2G.js";import{F as l,G as w,M as b,V as m,W as M,Z as n,a as i,b as s,d as D,db as o,e as S,eb as u,f as y,l as p,o as h,oa as G,u as r,z as I,za as K}from"./chunk-S7LRKC3Z.js";var Y=(()=>{var d;let c=class c{constructor(){S(this,d,void 0);this.scrollToTop=0,this.scrollState=u({scrollTo:this.scrollToTop}),this.scroll=o(()=>this.scrollState().scrollTo),this.http=K(j),this.options={method:"GET",headers:{accept:"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI4ZjZmNDhmZWQ2NWJkNDNjM2M1MDc0MDEwMDE1Y2M1MSIsInN1YiI6IjY0NTYzOTE3OTFmMGVhMDE3YmNjOWI0ZiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.JmQ9hCMyvUNPimkE1x3nIvShYlOLP8O5XfwYy9vOkj0"}},this.state=u({movies:[],genres:[],loading:!0,lastKnownMovie:null,page:1,error:null,genre:null}),this.movieDetailState=u({data:[],loading:!0}),this.actorState=u({data:null,loading:!0}),y(this,d,u(["now_playing","popular","top_rated","upcoming"])),this.movielist=D(this,d).asReadonly(),this.movies=o(()=>this.state().movies),this.genres=o(()=>this.state().genres),this.loading=o(()=>this.state().loading),this.lastKnownMovie=o(()=>this.state().lastKnownMovie),this.page=o(()=>this.state().page),this.error=o(()=>this.state().error),this.selection=o(()=>this.listChoice()),this.genre=o(()=>this.state().genre),this.movieDetail=o(()=>this.movieDetailState().data),this.laodingDetail=o(()=>this.movieDetailState().loading),this.loadingActor=o(()=>this.actorState().loading),this.actorDetail=o(()=>this.actorState().data),this.genres$=this.getGenres(),this.pagination$=new p,this.paginationGenre$=new p,this.genre$=new p,this.movielist$=new p,this.listChoice=T(this.movielist$.pipe(m(this.movielist()[0]),r(t=>this.formatString(t)))),this.moviesByGenre$=this.genre$.pipe(n(()=>this.state.update(t=>s(i({},t),{movies:[],page:1}))),M(t=>this.paginationGenre$.pipe(b(),m(null),n(()=>{this.state.update(e=>s(i({},e),{loading:!0,genre:t.name}))}),w(e=>this.fetchMoviesByGenre(t.id,this.page()))))),this.error$=new p,this.movies$=this.movielist$.pipe(m("now_playing"),n(()=>{this.state.update(t=>s(i({},t),{lastKnownMovie:null}))}),M(t=>this.pagination$.pipe(b(),m(null),n(()=>{this.state.update(e=>s(i({},e),{loading:!0,genre:null}))}),w(e=>this.fetchMovies(t,this.page()))))),this.movieDetailId$=new p,this.movieDetails$=this.movieDetailId$.pipe(n(()=>this.movieDetailState.update(t=>s(i({},t),{loading:!0,data:[]}))),M(t=>I([this.fetchMovie(t),this.fetchMovieCast(t),this.fetchMovieTrailer(t),this.fetchMovieWatchProviders(t)]))),this.actorId$=new p,this.actorDetails$=this.actorId$.pipe(n(()=>this.actorState.update(t=>s(i({},t),{data:null,loading:!0}))),M(t=>this.fetchActorDetail(t))),this.movielist$.pipe(g()).subscribe(()=>{this.state.update(t=>s(i({},t),{movies:[],loading:!0,lastKnownMovie:null,page:1}))}),this.genres$.pipe(g()).subscribe(t=>{this.state.update(e=>s(i({},e),{genres:[...t]}))}),this.movies$.pipe(g(),n(t=>console.log("Movies: ",t.lastKnownMovie))).subscribe(t=>this.state.update(e=>s(i({},e),{movies:[...e.movies,...t.movies],loading:!1,lastKnownMovie:t.lastKnownMovie,page:e.page+1}))),this.moviesByGenre$.pipe(g(),n(t=>console.log("MovieGenre: ",t.lastKnownMovie))).subscribe(t=>this.state.update(e=>s(i({},e),{movies:[...e.movies,...t.movies],loading:!1,lastKnownMovie:t.lastKnownMovie,page:e.page+1}))),this.movieDetails$.pipe(g(),n(t=>console.log(t))).subscribe(t=>this.movieDetailState.update(e=>s(i({},e),{data:[...t],loading:!1}))),this.actorDetails$.pipe(g()).subscribe(t=>this.actorState.update(e=>s(i({},e),{data:t,loading:!1}))),this.error$.pipe(g()).subscribe(t=>this.state.update(e=>s(i({},e),{error:t})))}fetchMovies(t,e){return this.http.get(`https://api.themoviedb.org/3/movie/${t}?language=en-US&page=${e}`,this.options).pipe(l(v=>h),r(v=>{let a=v.results,$=a.length?a[a.length-1].title:null;return{movies:a,lastKnownMovie:$}}))}getGenres(){return this.http.get("https://api.themoviedb.org/3/genre/movie/list?language=en",this.options).pipe(l(t=>h),r(t=>t.genres))}fetchMoviesByGenre(t,e){return this.http.get(`https://api.themoviedb.org/3/discover/movie?include_adult=false&include_video=true&language=en-US&page=${e}&sort_by=popularity.desc&with_genres=${t}`,this.options).pipe(l(v=>h),r(v=>{let a=v.results,$=a.length?a[a.length-1].title:null;return{movies:a,lastKnownMovie:$}}))}fetchMovie(t){return this.http.get(`https://api.themoviedb.org/3/movie/${t}?language=en-US`,this.options).pipe(l(e=>h),r(e=>e))}fetchMovieCast(t){return this.http.get(`https://api.themoviedb.org/3/movie/${t}/credits?language=en-US`,this.options).pipe(l(e=>h),r(e=>e))}fetchMovieWatchProviders(t){return this.http.get(`https://api.themoviedb.org/3/movie/${t}/watch/providers`,this.options).pipe(l(e=>h),r(e=>e))}fetchMovieTrailer(t){return this.http.get(`https://api.themoviedb.org/3/movie/${t}/videos`,this.options).pipe(l(e=>h),r(e=>e))}fetchActorDetail(t){return this.http.get(`https://api.themoviedb.org/3/person/${t}`,this.options).pipe(l(e=>h),r(e=>e))}getMovieGenres(t){let e=[];if(t!==void 0){for(let v of t)e.push(this.genres().find(a=>+a.id===v));return e}else return[]}formatString(t){return t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLocaleLowerCase()).join(" ")}};d=new WeakMap,c.\u0275fac=function(e){return new(e||c)},c.\u0275prov=G({token:c,factory:c.\u0275fac,providedIn:"root"});let f=c;return f})();export{Y as a};
